<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Task Manager</title>
<style>
    body { font-family: "Helvetica Neue", Arial, sans-serif; background-color: #f4f7f6; color: #333; display: flex; justify-content: center; padding: 20px; margin: 0; }
    .container { background: #fff; width: 100%; max-width: 600px; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 1.5rem; }
    
    /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
    .input-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 25px; background: #fafafa; padding: 15px; border-radius: 8px; border: 1px solid #eee; }
    
    .row { display: flex; gap: 10px; }
    
    /* ã‚¹ãƒãƒ›ç”¨ã«rowã‚’ç¸¦ä¸¦ã³ã«ã™ã‚‹è¨­å®š (ç”»é¢å¹…ãŒç‹­ã„æ™‚) */
    @media (max-width: 480px) {
        .row { flex-direction: column; }
    }

    input[type="text"], input[type="date"], select { padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; }
    /* å…¥åŠ›æ¬„ã®å¹…èª¿æ•´ */
    #task-input { flex-grow: 2; }
    #desc-input { flex-grow: 1; }
    #due-input { flex-grow: 0; }
    
    button#add-btn { padding: 12px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 16px; width: 100%; transition: 0.2s; }
    button#add-btn:hover { background-color: #2980b9; }

    /* ãƒªã‚¹ãƒˆã‚¨ãƒªã‚¢ */
    ul { list-style: none; padding: 0; margin: 0; }
    li { background: #fff; border-bottom: 1px solid #eee; padding: 15px 10px; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; transition: 0.2s; }
    li:hover { background-color: #f9f9f9; }
    li.completed .task-main { text-decoration: line-through; color: #aaa; }
    li.completed .task-meta { opacity: 0.5; }
    
    .task-info { display: flex; flex-direction: column; gap: 4px; flex-grow: 1; cursor: pointer; }
    
    .task-header { display: flex; align-items: center; gap: 8px; }
    .task-title { font-weight: bold; font-size: 1.1rem; }
    
    .task-meta { font-size: 0.85rem; color: #666; display: flex; gap: 10px; flex-wrap: wrap; }
    .meta-item { display: flex; align-items: center; gap: 4px; }
    
    /* å„ªå…ˆåº¦ãƒ‰ãƒƒãƒˆ */
    .priority-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; flex-shrink: 0; }
    .p-high { background-color: #e74c3c; box-shadow: 0 0 5px #e74c3c; }
    .p-mid { background-color: #f1c40f; }
    .p-low { background-color: #2ecc71; }

    button.delete-btn { background: #e74c3c; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-size: 14px; white-space: nowrap; align-self: center; }
</style>
</head>
<body>

<div class="container">
    <h2>ğŸ“‹ ã‚¿ã‚¹ã‚¯ç®¡ç†</h2>
    
    <div class="input-group">
        <input type="text" id="task-input" placeholder="ã‚¿ã‚¹ã‚¯å (ä¾‹: ä¼šè­°è³‡æ–™ä½œæˆ)">
        
        <div class="row">
            <input type="text" id="desc-input" placeholder="æ¦‚è¦ãƒ»è©³ç´°ãƒ¡ãƒ¢">
            <input type="date" id="due-input" title="æœŸé™">
        </div>

        <div class="row">
            <select id="priority-select" style="flex-grow: 1;">
                <option value="high">å„ªå…ˆåº¦: é«˜</option>
                <option value="mid" selected>å„ªå…ˆåº¦: ä¸­</option>
                <option value="low">å„ªå…ˆåº¦: ä½</option>
            </select>
        </div>
        <button id="add-btn">ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </button>
    </div>

    <ul id="task-list">
    </ul>
</div>

<script>
    // è¦ç´ ã®å–å¾—
    const taskInput = document.getElementById('task-input');
    const descInput = document.getElementById('desc-input');
    const dueInput = document.getElementById('due-input');
    const prioritySelect = document.getElementById('priority-select');
    const addBtn = document.getElementById('add-btn');
    const taskList = document.getElementById('task-list');

    // ä¿å­˜ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚’èª­ã¿è¾¼ã‚€
    document.addEventListener('DOMContentLoaded', loadTasks);

    // è¿½åŠ ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    addBtn.addEventListener('click', addTask);
    // ã‚¿ã‚¹ã‚¯å…¥åŠ›æ¬„ã§Enterã‚­ãƒ¼ã§ã‚‚è¿½åŠ 
    taskInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') addTask();
    });

    function addTask() {
        const text = taskInput.value;
        const desc = descInput.value;
        const due = dueInput.value;
        const priority = prioritySelect.value;

        if (text === '') return alert("ã‚¿ã‚¹ã‚¯åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");

        createTaskElement(text, desc, due, priority, false);
        saveTasks();
        
        // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
        taskInput.value = '';
        descInput.value = '';
        dueInput.value = '';
        prioritySelect.value = 'mid'; 
    }

    function createTaskElement(text, desc, due, priority, completed) {
        const li = document.createElement('li');
        if(completed) li.classList.add('completed');

        let dotClass = 'p-mid';
        if(priority === 'high') dotClass = 'p-high';
        if(priority === 'low') dotClass = 'p-low';

        // æœŸé™æ—¥ã®è¡¨ç¤ºæ•´å½¢
        const dueDisplay = due ? `ğŸ“… æœŸé™: ${due}` : '';
        // æ¦‚è¦ã®è¡¨ç¤ºæ•´å½¢
        const descDisplay = desc ? `ğŸ“ ${desc}` : '';

        li.innerHTML = `
            <div class="task-info" onclick="toggleComplete(this)">
                <div class="task-header">
                    <span class="priority-dot ${dotClass}" title="å„ªå…ˆåº¦"></span>
                    <span class="task-title task-main">${text}</span>
                </div>
                ${(desc || due) ? `
                <div class="task-meta">
                    ${dueDisplay ? `<span class="meta-item">${dueDisplay}</span>` : ''}
                    ${descDisplay ? `<span class="meta-item">${descDisplay}</span>` : ''}
                </div>
                ` : ''}
            </div>
            <button class="delete-btn" onclick="deleteTask(this)">å‰Šé™¤</button>
        `;
        
        // æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’ãƒªã‚¹ãƒˆã®ä¸€ç•ªä¸Šã«è¿½åŠ 
        taskList.prepend(li);
    }

    function toggleComplete(div) {
        div.parentElement.classList.toggle('completed');
        saveTasks();
    }

    function deleteTask(btn) {
        if(confirm('ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
            btn.parentElement.remove();
            saveTasks();
        }
    }

    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    function saveTasks() {
        const tasks = [];
        document.querySelectorAll('#task-list li').forEach(li => {
            const title = li.querySelector('.task-title').innerText;
            
            // æ¦‚è¦ã¨æœŸé™ã‚’å–å¾—ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ï¼‰
            let desc = '';
            let due = '';
            const metaItems = li.querySelectorAll('.meta-item');
            metaItems.forEach(item => {
                const txt = item.innerText;
                if(txt.includes('ğŸ“')) desc = txt.replace('ğŸ“ ', '');
                if(txt.includes('ğŸ“…')) due = txt.replace('ğŸ“… æœŸé™: ', '');
            });

            const completed = li.classList.contains('completed');
            
            let priority = 'mid';
            if(li.querySelector('.p-high')) priority = 'high';
            if(li.querySelector('.p-low')) priority = 'low';

            tasks.push({ text: title, desc, due, priority, completed });
        });
        
        // è¡¨ç¤ºé †ï¼ˆä¸Šã‹ã‚‰ï¼‰ã‚’ç¶­æŒã—ã¦ä¿å­˜
        localStorage.setItem('myTasksV2', JSON.stringify(tasks));
    }

    function loadTasks() {
        // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤‰ã‚ã£ã¦ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãŒå¤‰ã‚ã£ãŸãŸã‚ã‚­ãƒ¼ã‚’'myTasksV2'ã«å¤‰æ›´ã—ã¾ã—ãŸãŒã€
        // æ—§ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°èª­ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¦ã‚‚è‰¯ã„ã§ã™ï¼ˆä»Šå›ã¯ç°¡æ˜“çš„ã«V2æ–°è¦ã¨ã—ã¦ã„ã¾ã™ï¼‰
        const tasks = JSON.parse(localStorage.getItem('myTasksV2')) || [];
        
        taskList.innerHTML = '';
        // prependã§è¿½åŠ ã—ã¦ã„ããŸã‚ã€é…åˆ—ã‚’é€†é †ã«ã—ã¦å¤ã„ã‚‚ã®ã‹ã‚‰å‡¦ç†ã•ã›ã‚‹
        tasks.reverse().forEach(task => { 
             createTaskElement(task.text, task.desc, task.due, task.priority, task.completed);
        });
    }
</script>
</body>
</html>
