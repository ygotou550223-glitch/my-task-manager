<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Task Manager</title>
<style>
    body { font-family: "Helvetica Neue", Arial, sans-serif; background-color: #f4f7f6; color: #333; display: flex; justify-content: center; padding: 20px; margin: 0; }
    .container { background: #fff; width: 100%; max-width: 600px; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    h2 { text-align: center; color: #2c3e50; margin-bottom: 20px; font-size: 1.5rem; }
    
    /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
    .input-group { display: flex; flex-direction: column; gap: 10px; margin-bottom: 25px; background: #fafafa; padding: 15px; border-radius: 8px; border: 1px solid #eee; }
    
    .row { display: flex; gap: 10px; }
    
    /* ã‚¹ãƒãƒ›ç”¨ã«rowã‚’ç¸¦ä¸¦ã³ã«ã™ã‚‹è¨­å®š */
    @media (max-width: 480px) {
        .row { flex-direction: column; }
    }

    input[type="text"], input[type="date"], select { padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px; box-sizing: border-box; }
    /* å…¥åŠ›æ¬„ã®å¹…èª¿æ•´ */
    #task-input { flex-grow: 2; width: 100%; }
    #desc-input { flex-grow: 1; }
    #due-input { flex-grow: 0; }
    
    button#add-btn { padding: 12px; background-color: #3498db; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 16px; width: 100%; transition: 0.2s; }
    button#add-btn:hover { background-color: #2980b9; }

    /* ãƒªã‚¹ãƒˆã‚¨ãƒªã‚¢ */
    ul { list-style: none; padding: 0; margin: 0; }
    li { background: #fff; border-bottom: 1px solid #eee; padding: 15px 10px; display: flex; justify-content: space-between; align-items: flex-start; gap: 10px; transition: 0.2s; }
    li:hover { background-color: #f9f9f9; }
    li.completed .task-main { text-decoration: line-through; color: #aaa; }
    li.completed .task-meta { opacity: 0.5; }
    
    .task-info { display: flex; flex-direction: column; gap: 4px; flex-grow: 1; cursor: pointer; }
    
    .task-header { display: flex; align-items: center; gap: 8px; }
    .task-title { font-weight: bold; font-size: 1.1rem; }
    
    .task-meta { font-size: 0.85rem; color: #666; display: flex; gap: 10px; flex-wrap: wrap; }
    .meta-item { display: flex; align-items: center; gap: 4px; }
    
    /* å„ªå…ˆåº¦ãƒ‰ãƒƒãƒˆ */
    .priority-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; flex-shrink: 0; }
    .p-high { background-color: #e74c3c; box-shadow: 0 0 5px #e74c3c; }
    .p-mid { background-color: #f1c40f; }
    .p-low { background-color: #2ecc71; }

    /* ãƒœã‚¿ãƒ³ç¾¤ */
    .btn-group { display: flex; gap: 5px; flex-direction: column; justify-content: center; }
    button.action-btn { color: white; border: none; padding: 6px 10px; border-radius: 4px; cursor: pointer; font-size: 12px; white-space: nowrap; }
    .delete-btn { background: #e74c3c; }
    .edit-btn { background: #2ecc71; }

    /* --- ç·¨é›†ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ«ã®ã‚¹ã‚¿ã‚¤ãƒ« --- */
    .modal-overlay {
        display: none; /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1000;
    }
    .modal-content {
        background: white; padding: 20px; border-radius: 8px; width: 90%; max-width: 400px;
        box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        display: flex; flex-direction: column; gap: 15px;
    }
    .modal-header { font-weight: bold; font-size: 1.2rem; color: #2c3e50; text-align: center; }
    .modal-actions { display: flex; gap: 10px; margin-top: 10px; }
    .modal-actions button { flex: 1; padding: 10px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    .save-btn { background: #3498db; color: white; }
    .cancel-btn { background: #95a5a6; color: white; }

</style>
</head>
<body>

<div class="container">
    <h2>ğŸ“‹ ã‚¿ã‚¹ã‚¯ç®¡ç†</h2>
    
    <div class="input-group">
        <input type="text" id="task-input" placeholder="ã‚¿ã‚¹ã‚¯å (ä¾‹: ä¼šè­°è³‡æ–™ä½œæˆ)">
        
        <div class="row">
            <input type="text" id="desc-input" placeholder="æ¦‚è¦ãƒ»è©³ç´°ãƒ¡ãƒ¢">
            <input type="date" id="due-input" title="æœŸé™">
        </div>

        <div class="row">
            <select id="priority-select" style="flex-grow: 1;">
                <option value="high">å„ªå…ˆåº¦: é«˜</option>
                <option value="mid" selected>å„ªå…ˆåº¦: ä¸­</option>
                <option value="low">å„ªå…ˆåº¦: ä½</option>
            </select>
        </div>
        <button id="add-btn">ã‚¿ã‚¹ã‚¯ã‚’è¿½åŠ </button>
    </div>

    <ul id="task-list">
    </ul>
</div>

<div id="edit-modal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-header">ã‚¿ã‚¹ã‚¯ã®ç·¨é›†</div>
        <input type="text" id="edit-task-input" placeholder="ã‚¿ã‚¹ã‚¯å">
        <input type="text" id="edit-desc-input" placeholder="æ¦‚è¦ãƒ»è©³ç´°ãƒ¡ãƒ¢">
        <input type="date" id="edit-due-input">
        <select id="edit-priority-select">
            <option value="high">å„ªå…ˆåº¦: é«˜</option>
            <option value="mid">å„ªå…ˆåº¦: ä¸­</option>
            <option value="low">å„ªå…ˆåº¦: ä½</option>
        </select>
        <div class="modal-actions">
            <button class="cancel-btn" onclick="closeEditModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button class="save-btn" onclick="saveEdit()">ä¿å­˜ã™ã‚‹</button>
        </div>
    </div>
</div>

<script>
    // è¦ç´ ã®å–å¾—
    const taskInput = document.getElementById('task-input');
    const descInput = document.getElementById('desc-input');
    const dueInput = document.getElementById('due-input');
    const prioritySelect = document.getElementById('priority-select');
    const addBtn = document.getElementById('add-btn');
    const taskList = document.getElementById('task-list');

    // ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ«ç”¨ã®è¦ç´ 
    const editModal = document.getElementById('edit-modal');
    const editTaskInput = document.getElementById('edit-task-input');
    const editDescInput = document.getElementById('edit-desc-input');
    const editDueInput = document.getElementById('edit-due-input');
    const editPrioritySelect = document.getElementById('edit-priority-select');
    let currentEditLi = null; // ç¾åœ¨ç·¨é›†ä¸­ã®liè¦ç´ ã‚’ä¿æŒã™ã‚‹å¤‰æ•°

    // ä¿å­˜ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚’èª­ã¿è¾¼ã‚€
    document.addEventListener('DOMContentLoaded', loadTasks);

    // è¿½åŠ ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    addBtn.addEventListener('click', addTask);
    // ã‚¿ã‚¹ã‚¯å…¥åŠ›æ¬„ã§Enterã‚­ãƒ¼ã§ã‚‚è¿½åŠ 
    taskInput.addEventListener('keypress', function (e) {
        if (e.key === 'Enter') addTask();
    });

    function addTask() {
        const text = taskInput.value;
        const desc = descInput.value;
        const due = dueInput.value;
        const priority = prioritySelect.value;

        if (text === '') return alert("ã‚¿ã‚¹ã‚¯åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼");

        createTaskElement(text, desc, due, priority, false);
        saveTasks();
        
        // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
        taskInput.value = '';
        descInput.value = '';
        dueInput.value = '';
        prioritySelect.value = 'mid'; 
    }

    function createTaskElement(text, desc, due, priority, completed) {
        const li = document.createElement('li');
        if(completed) li.classList.add('completed');

        updateLiContent(li, text, desc, due, priority);
        
        // æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’ãƒªã‚¹ãƒˆã®ä¸€ç•ªä¸Šã«è¿½åŠ 
        taskList.prepend(li);
    }

    // liã®ä¸­èº«ï¼ˆHTMLï¼‰ã‚’ç”Ÿæˆãƒ»æ›´æ–°ã™ã‚‹é–¢æ•°
    function updateLiContent(li, text, desc, due, priority) {
        let dotClass = 'p-mid';
        if(priority === 'high') dotClass = 'p-high';
        if(priority === 'low') dotClass = 'p-low';

        // æœŸé™ã¨æ¦‚è¦ã®è¡¨ç¤ºæ•´å½¢
        const dueDisplay = due ? `ğŸ“… æœŸé™: ${due}` : '';
        const descDisplay = desc ? `ğŸ“ ${desc}` : '';

        // ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’datasetã«ä¿å­˜ï¼ˆç·¨é›†æ™‚ã®èª­ã¿è¾¼ã¿ç”¨ï¼‰
        li.dataset.text = text;
        li.dataset.desc = desc;
        li.dataset.due = due;
        li.dataset.priority = priority;

        li.innerHTML = `
            <div class="task-info" onclick="toggleComplete(this)">
                <div class="task-header">
                    <span class="priority-dot ${dotClass}" title="å„ªå…ˆåº¦"></span>
                    <span class="task-title task-main">${text}</span>
                </div>
                ${(desc || due) ? `
                <div class="task-meta">
                    ${dueDisplay ? `<span class="meta-item">${dueDisplay}</span>` : ''}
                    ${descDisplay ? `<span class="meta-item">${descDisplay}</span>` : ''}
                </div>
                ` : ''}
            </div>
            <div class="btn-group">
                <button class="action-btn edit-btn" onclick="openEditModal(this)">ç·¨é›†</button>
                <button class="action-btn delete-btn" onclick="deleteTask(this)">å‰Šé™¤</button>
            </div>
        `;
    }

    function toggleComplete(div) {
        div.parentElement.classList.toggle('completed');
        saveTasks();
    }

    function deleteTask(btn) {
        if(confirm('ã“ã®ã‚¿ã‚¹ã‚¯ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
            // è¦ªã®è¦ªï¼ˆliï¼‰ã‚’æ¢ã—ã¦å‰Šé™¤
            btn.closest('li').remove();
            saveTasks();
        }
    }

    // --- ç·¨é›†æ©Ÿèƒ½é–¢é€£ ---

    function openEditModal(btn) {
        // ãƒœã‚¿ãƒ³ã®è¦ªã®è¦ªã§ã‚ã‚‹liè¦ç´ ã‚’å–å¾—
        currentEditLi = btn.closest('li');
        
        // datasetã‹ã‚‰å…ƒã®å€¤ã‚’å–å¾—ã—ã¦å…¥åŠ›æ¬„ã«ã‚»ãƒƒãƒˆ
        editTaskInput.value = currentEditLi.dataset.text || "";
        editDescInput.value = currentEditLi.dataset.desc || "";
        editDueInput.value = currentEditLi.dataset.due || "";
        editPrioritySelect.value = currentEditLi.dataset.priority || "mid";

        // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
        editModal.style.display = 'flex';
    }

    function closeEditModal() {
        editModal.style.display = 'none';
        currentEditLi = null;
    }

    function saveEdit() {
        if (!currentEditLi) return;
        
        const newText = editTaskInput.value;
        const newDesc = editDescInput.value;
        const newDue = editDueInput.value;
        const newPriority = editPrioritySelect.value;

        if (newText === '') return alert("ã‚¿ã‚¹ã‚¯åã¯å¿…é ˆã§ã™");

        // liã®ä¸­èº«ã‚’æ›´æ–°
        updateLiContent(currentEditLi, newText, newDesc, newDue, newPriority);
        
        // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚‚æ›´æ–°
        saveTasks();
        closeEditModal();
    }

    // --- ä¿å­˜ãƒ»èª­ã¿è¾¼ã¿é–¢é€£ ---

    // ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    function saveTasks() {
        const tasks = [];
        document.querySelectorAll('#task-list li').forEach(li => {
            // datasetã‹ã‚‰æœ€æ–°ã®å€¤ã‚’å–å¾—ã—ã¦ä¿å­˜
            const text = li.dataset.text;
            const desc = li.dataset.desc;
            const due = li.dataset.due;
            const priority = li.dataset.priority;
            const completed = li.classList.contains('completed');

            tasks.push({ text, desc, due, priority, completed });
        });
        
        // è¡¨ç¤ºé †ï¼ˆä¸Šã‹ã‚‰ï¼‰ã‚’ç¶­æŒã—ã¦ä¿å­˜
        localStorage.setItem('myTasksV3', JSON.stringify(tasks));
    }

    function loadTasks() {
        // V3ã‚­ãƒ¼ã«å¤‰æ›´ï¼ˆãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ­ã‚¸ãƒƒã‚¯ã‚’å¤‰ãˆãŸãŸã‚ï¼‰
        // å¤ã„V2ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°ãã‚Œã‚’å¼•ãç¶™ã„ã§è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        let tasks = JSON.parse(localStorage.getItem('myTasksV3'));
        
        // V3ãŒãªã„å ´åˆã€ä»¥å‰ã®V2ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã¿ã‚‹ï¼ˆç§»è¡Œæªç½®ï¼‰
        if (!tasks) {
            tasks = JSON.parse(localStorage.getItem('myTasksV2')) || [];
        }

        taskList.innerHTML = '';
        // é€†é †ã§è¿½åŠ ï¼ˆprependã®ãŸã‚ï¼‰
        tasks.reverse().forEach(task => { 
             createTaskElement(task.text, task.desc, task.due, task.priority, task.completed);
        });
    }
</script>
</body>
</html>
